<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Elearn project">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
    <link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
    <link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
    <link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/animate.css">
    <link href="plugins/video-js/video-js.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="styles/main_styles.css">
    <link rel="stylesheet" href="styles/databasesTyp.css">
    <link rel="stylesheet" href="./styles/toast.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="styles/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- pdf.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <!-- Toastr JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- SQL.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
    <!-- <script type="module" src="./js/modal.js"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script type="module">
        import { auth, db } from './js/firebaseConfig.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";
        import {
            doc,
            setDoc,
            updateDoc,
            getDoc,
            getDocs,
            collection,
            query,
            orderBy,
            FieldValue,
        } from 'https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js';
        import { deleteField } from 'https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js';
        import { createModal } from './js/modal.js';
        // import { generateCertificate } from './js/certificateGenerator.js';

        toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-top-center",
            "preventDuplicates": true,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "3000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
        document.addEventListener('DOMContentLoaded', () => {

            // Function to extract the YouTube video ID from the URL
            function getYouTubeVideoId(url) {
                const videoIdMatch = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?/);
                return videoIdMatch ? videoIdMatch[1] : null;
            }

            const myProgressButton = document.getElementById('myProgressButton');
            myProgressButton.addEventListener('click', function () {
                window.location.href = 'progress.html'
            });

            const hQuestion = document.getElementById('BtnQuestion');

            hQuestion.addEventListener('click', function () {
                window.location.href = 'contact.html';
            })

            const toggleAuthDisplay = (user) => {
                const authLinks = document.getElementById('authLinks');
                const profileIcon = document.getElementById('profileIcon');
                const userName = document.getElementById('userName');
                const userEmail = document.getElementById('userEmail');
                const contactLink = document.querySelector('.main_nav a[href="contact.html"]');

                if (user) {
                    // Hide login/register links
                    authLinks.style.display = 'none';
                    // Show profile section
                    profileIcon.style.display = 'block';
                    // Display user's email
                    userEmail.textContent = user.email;

                    // Fetch user's custom data from Firestore
                    const userDocRef = doc(db, 'users', user.uid);
                    getDoc(userDocRef).then((docSnapshot) => {
                        if (docSnapshot.exists()) {
                            const userData = docSnapshot.data();
                            userName.textContent = 'Name : ' + userData.name || 'User'; // Display name or fallback to 'User'
                            userEmail.textContent = 'Email : ' + userData.email;
                            if (userData.role === 'admin') {
                                contactLink.textContent = 'Admin Panel'; // Change link text
                                contactLink.setAttribute('href', 'admin.html'); // Change href to admin page
                            }
                            else {
                                contactLink.textContent = 'Contact Us';
                            }

                        }
                    }).catch((error) => {
                        console.log('Error fetching user data:', error);
                        toastr.error('Error fetching user data');
                    });
                } else {
                    // Show login/register links
                    authLinks.style.display = 'block';
                    // Hide profile section
                    profileIcon.style.display = 'none';
                }
            };

            // Handle sign-out
            document.getElementById('signOutButton').addEventListener('click', () => {
                const profileContainer = document.getElementById('profileIcon');

                signOut(auth).then(() => {
                    console.log('User signed out');
                    toastr.success('User Signed Out Successfully');
                    profileIcon.style.display = "none";

                }).catch((error) => {
                    console.error('Error signing out:', error);
                    toastr.error('Error Signing Out Please Try Again!');
                });
            });

            // Profile icon toggle
            const profileIcon = document.getElementById('profileIcon');
            const profileSection = document.getElementById('profileSection');

            profileIcon.onclick = () => {
                profileSection.style.display = profileSection.style.display === 'block' ? 'none' : 'block';
            };

            // Function to calculate and display user progress
            async function calculateUserProgress(userId) {
                try {
                    // Firestore initialization (assuming it's already configured elsewhere in your project)
                    // const currentUser = auth.currentUser;
                    console.log('userId', userId);

                    if (!userId) {
                        console.error('No user is currently logged in!');
                        return;
                    }
                    // const userId = currentUser.uid;
                    const usersRef = collection(db, 'users');

                    // Fetch the user data from Firestore
                    const userDoc = await getDoc(doc(usersRef, userId));

                    if (!userDoc.exists) {
                        console.error('User not found!');
                        return;
                    }

                    const userData = userDoc.data();
                    // console.log('userData.quizzes', userData);

                    if (!userData.quizzes) {
                        console.error('quizzes not found!');
                        return;
                    }

                    // Get the number of completed lessons (length of the quizzes object)
                    const completedLessons = Object.keys(userData.quizzes || {}).length;

                    // Total number of lessons
                    const totalLessons = 15;

                    // Calculate the star rating
                    const stars = Math.round((completedLessons / totalLessons) * 5);

                    // Generate star icons using Font Awesome
                    let starIcons = '';
                    for (let i = 0; i < stars; i++) {
                        starIcons += '<i class="fas fa-star" style="color: gold; font-size: 1.5em;"></i> ';
                    }
                    for (let i = stars; i < 5; i++) {
                        starIcons += '<i class="far fa-star" style="color: gold; font-size: 1.5em;"></i> ';
                    }

                    // Display progress and star rating
                    console.log(`Progress: ${completedLessons}/${totalLessons}`);
                    console.log(`Rating: ${stars}/5`);

                    // Render the progress on your webpage
                    const progressElement = document.getElementById('progress');
                    if (progressElement) {
                        progressElement.innerHTML = `
                 
                        <p>${starIcons} (${stars}/5)</p>
                    `;
                    }

                } catch (error) {
                    console.error('Error calculating progress:', error);
                }
            }

            ////////////////////////////////////////////////////////////////////////////////////
            onAuthStateChanged(auth, async (user) => {
                // console.log('current user', user ? user.email : null);
                const profileIcon = document.getElementById('profileIcon');

                if (user) {
                    const userId = user.uid;

                    calculateUserProgress(userId);
                    // Fetch user progress
                    const startCourseBtn = document.getElementById('startCourseBtn');
                    // console.log('startCourseBtn :', startCourseBtn);
                    const userProgress = await fetchUserProgress(userId);
                    // console.log('userProgress lenght : ', userProgress);
                    startCourseBtn.style.display = 'block';
                    if (Object.keys(userProgress).length === 0) {
                        startCourseBtn.innerText = 'Start Course';
                    }
                    else if (Object.keys(userProgress).length >= 15) {
                        startCourseBtn.innerText = 'Restart Course';
                    }
                    else {
                        startCourseBtn.innerText = 'Continue Course';
                    }
                    toggleAuthDisplay(user);
                    // console.log('current user', user ? user.email : null);
                    // Display lessons based on progress
                    await displayLessons(userId, userProgress);
                }
                else {
                    profileIcon.style.display = 'none';
                    window.location.href = 'index.html';
                }
            });

            document.getElementById('startCourseBtn').addEventListener('click', async () => {
                const courseOverview = document.getElementById('courseOverview');
                const lessonsContainer = document.getElementById('lessonsContainer');
                courseOverview.style.display = 'none';
                lessonsContainer.style.marginTop = '50px';
                document.getElementById('lessonsContainer').style.display = 'flex'; // Show lessons container
            });
            /////////////////////////////////////////////////////////////////////////////////
            let currentLessonContent = null; // Track the currently displayed lesson content

            const viewLessonContent = async (lessonId, viewLessonBtn) => {

                const reQuBtns = document.getElementsByClassName('quizContainer');

                while (reQuBtns.length > 0) {
                    reQuBtns[0].parentNode.removeChild(reQuBtns[0]);
                }

                if (currentLessonContent) {
                    currentLessonContent.remove();
                    currentLessonContent = null; // Clear the reference
                }

                const allLessonButtons = document.querySelectorAll('.view-lesson');
                allLessonButtons.forEach((button) => {
                    button.disabled = false; // Enable all buttons
                });
                viewLessonBtn.disabled = true; // Disable only the clicked button

                const startLessonButton = document.querySelector('.start-lesson');

                if (startLessonButton && startLessonButton.disabled) {
                    const lessonContent = document.querySelector('.lessonContent');
                    if (lessonContent && document.body.contains(lessonContent)) {

                        lessonsContainer.removeChild(lessonContent);
                        // console.log('wttttttttttttttttttttttttffffffffffff');
                        startLessonButton.disabled = false;
                    } else {
                        console.log('lessonContent not found or not a child of body.');
                    }
                }
                try {
                    // Reference to the 'lessons' collection inside your course (SQL in this case)
                    const lessonRef = doc(db, 'Courses', 'SQL', 'lessons', lessonId);
                    // Fetch the lesson document by ID
                    const lessonDoc = await getDoc(lessonRef);

                    if (lessonDoc.exists()) {

                        const lessonText1 = document.createElement('div');
                        const lessonData = lessonDoc.data();
                        console.log(' viewLessonContent lessonData : ', lessonData);
                        const lessonContent = lessonData.textContent || "<p>No content available for this lesson.</p>";
                        const videoUrl = lessonData.videoUrl && lessonData.videoUrl !== ''
                            ? `<div class="video-container">
                                    <iframe 
                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                                        src="https://www.youtube.com/embed/${getYouTubeVideoId(lessonData.videoUrl)}"
                                        title="YouTube video player" frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                    </iframe>
                                </div>`
                            : "<p style='text-align: center; color: grey;'>Video not available for this lesson.</p>";

                        lessonText1.classList.add('lessonContent1');
                        lessonText1.style.padding = '20px';
                        lessonText1.style.marginTop = '20px';
                        lessonText1.innerHTML = `
                                <div class="card shadow-sm h-100" style="border-radius: 10px;">
                                    <div class="card-bodyv">
                                        ${videoUrl} <!-- Use video element or placeholder message -->
                                        <div class="margin-top-10">${lessonContent} <!-- Use lesson content or placeholder message --></div>
                                       <button class="close-modal">Close</button>
                                    </div>
                                </div>
                            `;

                        lessonsContainer.appendChild(lessonText1);
                        currentLessonContent = lessonText1;
                        setTimeout(() => {
                            // Get the footer position
                            const footer = document.querySelector('.footer');
                            const footerPosition = footer ? footer.getBoundingClientRect().top + window.pageYOffset : document.body.scrollHeight;

                            // Get the position of the modal and check if it overlaps with the footer
                            const containerOffset = lessonText1.getBoundingClientRect().top + window.pageYOffset;
                            const offset = 50; // Adjust this value for how far above the element you want to scroll

                            const modalBottom = containerOffset + lessonText1.offsetHeight;
                            if (modalBottom > footerPosition) {
                                // Adjust scroll to make sure modal fits above footer
                                window.scrollTo({
                                    top: footerPosition - window.innerHeight + offset,
                                    behavior: 'smooth'
                                });
                            } else {
                                window.scrollTo({
                                    top: containerOffset - offset,
                                    behavior: 'smooth'
                                });
                            }
                        }, 0);

                        // Add event listener to close the modal
                        lessonText1.querySelector('.close-modal').addEventListener('click', () => {
                            window.scrollTo({
                                top: 0,
                                behavior: 'smooth'
                            });

                            setTimeout(() => {
                                document.body.removeChild(lessonText1); // Close the modal
                            }, 300); // Delay to let the scroll animation complete

                            if (currentLessonContent) {
                                currentLessonContent.remove();
                                currentLessonContent = null; // Reset after removal
                            }
                            allLessonButtons.forEach((button) => {
                                button.disabled = false; // Re-enable all buttons
                            });
                        });
                    } else {
                        console.error('No such lesson!');
                    }
                } catch (error) {
                    console.log('viewLessonContent catch error :', error);
                }
            }

            /////////////////////////////////////////////////////////////////////////////////
            const displayLessons = async (userId, userProgress) => {
                window.scrollTo(0, 0);
                const lessonsContainer = document.getElementById('lessonsContainer');
                lessonsContainer.innerHTML = ""; // Clear previous content
                // console.log('displayLessons userId', userId);

                try {
                    // Fetch current user data from Firestore
                    const userRef = doc(db, 'users', userId);
                    const userSnapshot = await getDoc(userRef);

                    if (!userSnapshot.exists()) {
                        console.error('User not found');
                        return;
                    }

                    const userData = userSnapshot.data();
                    const isAdmin = userData.role === 'admin';
                    // console.log('User role:', userData.role);
                    // Fetch lessons
                    const lessonsRef = collection(db, 'Courses', 'SQL', 'lessons');
                    const lessonsSnapshot = await getDocs(lessonsRef);

                    const lessons = lessonsSnapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .sort((a, b) => a.lessonNumber - b.lessonNumber); // Sort by 'lessonNumber'

                    // console.log('lessonDocs', lessons);

                    let currentLessonIndex = isAdmin ? -1 : lessons.findIndex(lesson => !userProgress[lesson.id]);
                    // console.log('currentLessonIndex', currentLessonIndex);

                    let lockRemainingLessons = false; // Flag to lock subsequent lessons for non-admins

                    if (lessons.length > 0) {
                        lessons.forEach((lesson, index) => {
                            const { id: lessonId, title, lessonNumber } = lesson;
                            const lessonElement = document.createElement('div');
                            lessonElement.classList.add('lesson');
                            if (userProgress[lessonId]) {
                                const marks = userProgress[lessonId].marks || 0;
                                if (marks >= 8) {
                                    // Display Completed Status in Green
                                    lessonElement.innerHTML = `
                            <div class="card shadow-sm h-100" style="border-radius: 10px;">
                                <div class="card-body">
                                    <h5 class="card-title" style="font-weight: bold; color: #0E3D57;">
                                        Lesson ${lessonNumber}: ${title} <br/>(Marks: ${marks}/10)<br/> Status:
                                        <span style="color: #28a745;">Completed ✅</span> 
                                    </h5>
                                    <button class="review-quiz" style="border-radius: 5px;" data-lesson="${lessonId}">
                                        Review Quiz
                                    </button>
                                     <button class="view-lesson" style="border-radius: 5px; margin-top:10px;" data-lesson="${lessonId}">
                                        View Lesson
                                    </button>
                                </div>
                            </div>
                        `;
                                    lessonElement.querySelector('.review-quiz').addEventListener('click', () => {
                                        displayQuizReview(lessonId, userSnapshot.id);
                                    });
                                    lessonElement.querySelector('.view-lesson').addEventListener('click', () => {
                                        const viewLessonBtn = event.target; // The specific button being clicked
                                        // console.log('Clicked button:', viewLessonBtn);
                                        viewLessonBtn.disabled = true;
                                        viewLessonContent(lessonId, viewLessonBtn); // Display the content of the lesson
                                    });
                                } else {
                                    // Display Not Passed Status in Red and lock subsequent lessons if user is not an admin
                                    lockRemainingLessons = !isAdmin; // Set lock flag if the user is not an admin
                                    lessonElement.innerHTML = `
                            <div class="card shadow-sm h-100" style="border-radius: 10px;">
                                <div class="card-body">
                                  <h5 class="card-title" style="font-weight: bold; color: #0E3D57;"> 
                                    Lesson ${lessonNumber}: ${title} <br/> (Marks: ${marks}/10)<br/> 
                                    Status: <span style="color: red;">Not Passed ❌</span>
                                </h5>
                                  <button class="view-lesson" style="border-radius: 5px; margin-top:10px;" data-lesson="${lessonId}">
                                        View Lesson
                                    </button>
                                    <button class="review-quiz" style="border-radius: 5px;" data-lesson="${lessonId}">
                                        Review Quiz
                                    </button>
                                    <button class="retake-quiz" style="border-radius: 5px; margin-top:10px" data-lesson="${lessonId}">
                                        Retake Quiz
                                    </button>
                                </div>
                            </div>
                        `;
                                    lessonElement.querySelector('.view-lesson').addEventListener('click', () => {
                                        const viewLessonBtn = event.target; // The specific button being clicked
                                        // console.log('Clicked button:', viewLessonBtn);
                                        viewLessonBtn.disabled = true;
                                        viewLessonContent(lessonId, viewLessonBtn); // Display the content of the lesson
                                    });
                                    lessonElement.querySelector('.review-quiz').addEventListener('click', () => {
                                        displayQuizReview(lessonId, userSnapshot.id);
                                    });
                                    lessonElement.querySelector('.retake-quiz').addEventListener('click', () => {
                                        console.log('what is goiing on!');
                                        displayRetakeQuiz(lessonId, userSnapshot.id);
                                    });
                                }
                            } else if ((index === currentLessonIndex || isAdmin) && !lockRemainingLessons) {
                                // Current lesson or admin access - show Start Lesson button if lessons aren't locked
                                lessonElement.innerHTML = `
                        <div class="card shadow-sm h-100" style="border-radius: 10px;">
                            <div class="card-body">
                                <h5 class="card-title" style="font-weight: bold; color: #0E3D57;">
                                    Lesson ${lessonNumber}: ${title}
                                </h5>
                                <button class="start-lesson" style="border-radius: 20px; background-color: #0E3D57; color:#fff;" data-lesson="${lessonId}">
                                    Start Lesson
                                </button>
                            </div>
                        </div>
                    `;
                                handleLessonProgress(userSnapshot.id, lessonElement, lessonId);

                            } else {
                                // Locked future lesson for non-admins or due to "Not Passed" status
                                lessonElement.innerHTML = `
                        <div class="card shadow-sm h-100" style="border-radius: 10px;">
                            <div class="card-body">
                                <h5 class="card-title" style="font-weight: bold; color: #0E3D57;">
                                    Lesson ${lessonNumber}: ${title}
                                </h5>
                                <button class="start-lesson btn btn-secondary" style="border-radius: 20px;" data-lesson="${lessonId}" disabled>
                                    Locked
                                </button>
                            </div>
                        </div>
                    `;
                            }
                            lessonsContainer.appendChild(lessonElement);
                        });
                    } else {
                        lessonsContainer.innerHTML = "<p>All lessons completed!</p>";
                    }
                } catch (error) {
                    console.error("Error fetching user or lessons data:", error);
                }
            };

            // Function to handle lesson progress
            const handleLessonProgress = async (userId, lessonElement, lessonId) => {
                const lessonsContainer = document.getElementById('lessonsContainer');
                const courseOverview = document.getElementById('courseOverview');
                const startLessonButton = lessonElement.querySelector('.start-lesson');

                const lessonText = document.createElement('div');

                startLessonButton.addEventListener('click', async () => {

                    const allLessonButtons = document.querySelectorAll('.view-lesson');
                    allLessonButtons.forEach((button) => {
                        button.disabled = false; // Enable all buttons
                    });
                    lessonsContainer.style.display = "flex";
                    const lessonContent1 = document.querySelector('.lessonContent1');
                    if (lessonContent1) {
                        document.body.removeChild(lessonContent1); // Close the modal
                    }
                    // Clear any existing lesson content
                    const existingLessonContent = document.querySelector('.lessonContent');
                    if (existingLessonContent) {
                        existingLessonContent.remove(); // Remove the previously displayed lesson content
                    }
                    // console.log(' start lesson cliked');
                    startLessonButton.disabled = true;
                    try {
                        // Fetch the full lesson content from Firestore using lessonId
                        const lessonRef = doc(db, `Courses/SQL/lessons/${lessonId}`);
                        const lessonSnapshot = await getDoc(lessonRef);

                        if (lessonSnapshot.exists()) {
                            const lessonData = lessonSnapshot.data();
                            // console.log('lessonData', lessonData);
                            const lessonContent = lessonData.textContent || "<p>No content available for this lesson.</p>";
                            const videoUrl = lessonData.videoUrl && lessonData.videoUrl !== ''
                                ? `<div class="video-container" style="position: relative; padding-top: 56.25%; margin-top: 15px;">
                                    <iframe 
                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                                        src="https://www.youtube.com/embed/${getYouTubeVideoId(lessonData.videoUrl)}"
                                        title="YouTube video player" frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                    </iframe>
                                </div>`
                                : "<p style='text-align: center; color: grey;'>Video not available for this lesson.</p>";

                            lessonText.classList.add('lessonContent');
                            lessonText.innerHTML = `
                                <div class="card shadow-sm h-100" style="border-radius: 10px;">
                                    <div class="card-bodyv">
                                        ${videoUrl} <!-- Use video element or placeholder message -->
                                        ${lessonContent} <!-- Use lesson content or placeholder message -->
                                        <button class="take-quiz" style="border-radius: 10px; margin-top: 15px;" data-lesson="${lessonId}">
                                            Take a quiz
                                        </button>
                                    </div>
                                </div>
                            `;

                            lessonsContainer.appendChild(lessonText);
                            setTimeout(() => {
                                const containerOffset = lessonText.getBoundingClientRect().top + window.pageYOffset;
                                const offset = 50; // Adjust this value for how far above the element you want to scroll

                                window.scrollTo({
                                    top: containerOffset - offset,
                                    behavior: 'smooth'
                                });
                            }, 0);
                            // Handle quiz button click
                            const takeQuizButton = lessonText.querySelector('.take-quiz');
                            if (takeQuizButton) {
                                takeQuizButton.addEventListener('click', async () => {
                                    takeQuizButton.disabled = true;

                                    try {
                                        const userProgress = await fetchUserProgress(userId);
                                        console.log('quiz try clicked');
                                        const quizQuestions = [];
                                        const quizRef = collection(db, `Courses/SQL/lessons/${lessonId}/quiz/quizDoc/questions`);
                                        const querySnapshot = await getDocs(quizRef);
                                        querySnapshot.forEach((doc) => {
                                            quizQuestions.push({ id: doc.id, ...doc.data() });
                                        });

                                        // Check if the quiz form already exists
                                        if (!document.getElementById('quizForm')) {
                                            // Display quiz form only if it doesn't already exist
                                            displayQuiz(quizQuestions, userId, lessonId, userProgress);
                                        } else {
                                            // console.log("Quiz form already displayed.");
                                        }

                                    } catch (error) {
                                        // console.error("Error fetching quiz questions: ", error);
                                        toastr.error("Error fetching quiz questions");
                                    }

                                });
                            } else {
                                // console.log(`Quiz button for lesson ${lessonId} not found.`);
                                toastr.error(`Quiz button for lesson not found.`);
                            }
                        } else {
                            // console.log(`Lesson data for ${lessonId} not found.`);
                            toastr.error(`Lesson data Not Found.`);
                        }

                    } catch (error) {
                        // console.log("Error fetching lesson content: ", error);
                        toastr.error("Error Fetching Lesson Content");
                    }
                    lessonsContainer.appendChild(lessonText);

                });
            };
            ///////////////////////////////////////////////////////////////////////////
            const displayRetakeQuiz = async (lessonId, id) => {

                const lessonContents = document.getElementsByClassName('lessonContent1');
                const vLessBtns = document.getElementsByClassName('view-lesson');

                // Loop through the HTMLCollection and remove each node
                // Enable all "View Lesson" buttons
                for (let i = 0; i < vLessBtns.length; i++) {
                    vLessBtns[i].disabled = false;
                }
                while (lessonContents.length > 0) {
                    lessonContents[0].parentNode.removeChild(lessonContents[0]);
                }

                // const j= ';';
                try {
                    const userProgress = await fetchUserProgress(id);
                    const quizQuestions = [];
                    const quizRef = collection(db, `Courses/SQL/lessons/${lessonId}/quiz/quizDoc/questions`);
                    const querySnapshot = await getDocs(quizRef);
                    querySnapshot.forEach((doc) => {
                        quizQuestions.push({ id: doc.id, ...doc.data() });
                    });

                    // Check if the quiz form already exists
                    if (!document.getElementById('quizForm')) {
                        // Display quiz form only if it doesn't already exist
                        console.log('retakeQuiz clicked twice ');
                        displayQuiz(quizQuestions, id, lessonId, userProgress);
                    } else {
                        // console.log("Quiz form already displayed.");
                    }

                } catch (error) {
                    // console.error("Error fetching quiz questions: ", error);
                    toastr.error("Error fetching quiz questions");
                }
            }

            function validateCodeAnswer(userSQL, solutionSQL) {
                // Trim and normalize the SQL strings to ensure minor differences like whitespace don't cause mismatches
                const normalizeSQL = (sql) => sql.replace(/\s+/g, ' ').trim().toLowerCase();

                const normalizedUserSQL = normalizeSQL(userSQL);
                const normalizedSolutionSQL = normalizeSQL(solutionSQL);

                // Compare the normalized SQL strings
                const isCorrect = normalizedUserSQL === normalizedSolutionSQL;

                // console.log('Validation Result:', isCorrect);
                return isCorrect;
            }
            // Function to reset (delete) the quiz data for retake
            const resetQuiz = async (userId, lessonId) => {
                try {
                    const userRef = doc(db, 'users', userId);
                    const userSnapshot = await getDoc(userRef);
                    if (!userSnapshot.exists()) {
                        console.error('User not found');
                        return;
                    }
                    // Reference to the specific quiz data under the user's 'quizzes' field
                    await updateDoc(userRef, {
                        [`quizzes.${lessonId}`]: deleteField() // Deletes the lesson's quiz data
                    });
                } catch (error) {
                    console.error("Error resetting quiz data:", error);
                }
            };

            async function fetchLessonSubCollectionLength(userId) {
                const questionsRef = collection(db, 'Courses', 'SQL', 'lessons');
                const lessonsSnapshot = await getDocs(questionsRef);
                return lessonsSnapshot.size; // Returns the number of documents in the sub-collection
            }

            // Function to display quiz questions (you can customize this for your UI)
            const displayQuiz = async (quizQuestions, userId, lessonId, userProgress) => {
                const quizContainer = document.createElement('form');
                quizContainer.classList.add('quizContainer');
                quizContainer.id = 'quizForm';
                // Loop through each question
                quizQuestions.forEach((question, index) => {
                    const questionElement = document.createElement('div');
                    questionElement.classList.add('quizQuestion');
                    let answerOptions = '';
                    // Check if the question is of type "code"
                    if (question.solutionSQL) {
                        // Display a textarea for SQL code input
                        answerOptions = `
                            <label for="codeAnswer${index}">Write your SQL query:</label><br/>
                            <textarea id="codeAnswer${index}" name="codeAnswer${index}" rows="5" cols="60" class='code-input'> </textarea>
                        `;
                    } else {
                        // Loop through the answers object (instead of array) to display answer options
                        answerOptions = Object.keys(question.answers).map((key) => {
                            const answer = question.answers[key];
                            return `
                            <label>
                                <input type="radio" name="question${index}" value="${key}">
                                ${answer.answer}
                            </label>
                        `;
                        }).join('');
                    }
                    // Set up the question and answer options
                    questionElement.innerHTML = `
                        <p>${index + 1}. ${question.questionText}</p>
                        ${answerOptions}
                        `;
                    quizContainer.appendChild(questionElement);
                });

                quizContainer.innerHTML += `<button type="submit">Submit Quiz</button> `;

                // Append quiz form to the container
                document.getElementById('lessonsContainer').appendChild(quizContainer);
                setTimeout(() => {
                    const containerOffset = quizContainer.getBoundingClientRect().top + window.pageYOffset;
                    const offset = 50; // Adjust this value for how far above the element you want to scroll

                    window.scrollTo({
                        top: containerOffset - offset,
                        behavior: 'smooth'
                    });
                }, 0);

                // Event listener for form submission
                quizContainer.addEventListener('submit', async (e) => {
                    e.preventDefault(); // Prevent default form submission

                    const userAnswers = quizQuestions.map((question, index) => {
                        if (question.solutionSQL) {
                            const codeAnswer = document.querySelector(`#codeAnswer${index}`).value;
                            return codeAnswer ? codeAnswer.trim() : null;
                        } else {
                            const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                            return selectedOption ? selectedOption.value : null; // Store the selected answer key (like "a1", "a2")
                        }
                    });
                    // console.log('userAnswers', userAnswers);

                    // Check if all questions are answered
                    const unansweredQuestions = userAnswers.some(answer => answer === null);
                    if (unansweredQuestions) {
                        toastr.warning("Please answer all the questions before submitting the quiz."); // Display warning
                        return; // Stop submission if there are unanswered questions
                    }

                    toastr.success('Quiz Submitted Successfully');
                    // Compare user's answers with correct answers and store the result
                    // Check answers for each question type
                    const result = await Promise.all(
                        quizQuestions.map(async (question, index) => {
                            const userAnswer = userAnswers[index];

                            let isCorrect = false;

                            if (question.solutionSQL) {
                                isCorrect = validateCodeAnswer(userAnswer, question.solutionSQL);
                            } else {
                                isCorrect = userAnswer !== null && question.answers[userAnswer].isCorrect;
                            }

                            return {
                                questionId: question.id,
                                userAnswer,
                                isCorrect,
                            };
                        })
                    );

                    // Save the user's progress and results in Firestore (your Firestore function should handle the storage)
                    await saveQuizResult(userId, lessonId, result);
                    const userProgress = await fetchUserProgress(userId);
                    const progressLength = Object.keys(userProgress).length;
                    const userProgressArray = Object.values(userProgress);

                    const allMarksAboveThreshold = userProgressArray.every(quiz => quiz.marks >= 8);
                    console.log('allMarksAboveThreshold :', allMarksAboveThreshold);

                    // Check if the user has completed all lessons
                    const lessonSubCollectionLength = await fetchLessonSubCollectionLength(userId);
                    console.log('Number of lessons:', lessonSubCollectionLength);

                    console.log(' userProgress.length', progressLength);

                    if (allMarksAboveThreshold && lessonSubCollectionLength === progressLength) {
                        console.log('SQL Fundamentals');
                        // Trigger the modal if the user completed all quizzes
                        createModal(
                            "Congratulations! You've completed all the lessons! You're a database pro now! 🌟🎓",
                            "Generate Certificate",
                            userId,
                            "SQL Fundamentals"
                        );
                    }
                    displayLessons(userId, userProgress);
                });
            };

            // Firestore save function
            const saveQuizResult = async (userId, lessonId, result) => {

                try {
                    const userProgressRef = doc(db, `users/${userId}`); // Reference to the user document
                    await setDoc(userProgressRef, {
                        quizzes: {
                            [lessonId]: { // Store the quiz data under the lessonId
                                marks: result.filter(item => item.isCorrect).length, // Calculate marks based on correct answers
                                quizResult: result // Save the full quiz result
                            }
                        }
                    }, { merge: true }); // Merge to avoid overwriting other fields in the user document
                    // console.log('Quiz result saved successfully');
                } catch (error) {
                    console.error('Error saving quiz result:', error);
                }
            };

            // Function to display the quiz review
            const displayQuizReview = async (lessonId, userId) => {
                // Fetch user's answers and quiz questions
                const userAnswers = await fetchUserAnswers(userId, lessonId);
                const quizQuestions = await fetchQuizQuestions(lessonId);

                const reviewContainer = document.createElement('div');
                reviewContainer.classList.add('quizReview');

                let totalMarks = 0; // To calculate the total score

                // Loop through each question
                quizQuestions.forEach((question, index) => {
                    const userAnswerIndex = userAnswers[index]?.userAnswer;
                    const isCorrect = userAnswers[index]?.isCorrect;

                    const reviewElement = document.createElement('div');
                    reviewElement.classList.add('quizQuestionReview');
                    reviewElement.innerHTML = `<p><strong>${index + 1}. ${question?.questionText}</strong></p>`;
                    let isCorrectAnswer = false;

                    if (question?.solutionSQL) {
                        // Check if the user's answer matches the correct solution SQL
                        isCorrectAnswer = userAnswerIndex === question.solutionSQL;
                        // Display the user's SQL answer
                        reviewElement.innerHTML += `<pre style="color: ${isCorrectAnswer ? 'green' : 'red'};">${userAnswerIndex}</pre>`;

                        if (isCorrectAnswer) {
                            // Include expected output only if it exists
                            if (question?.expectedOutput) {
                                reviewElement.innerHTML += `
                        <p><strong>Expected Output:</strong></p>
                        <pre>${JSON.stringify(question.expectedOutput)}</pre>
                      `;
                            }

                        } else {
                            // If the answer is incorrect
                            reviewElement.innerHTML += `
                        <p style="color: green;">Correct Answer:</p>
                        <pre style="color: green;">${question.solutionSQL}</pre>
                      `;

                            // Include expected output only if it exists
                            if (question?.expectedOutput) {
                                reviewElement.innerHTML += `
                        <p><strong>Expected Output:</strong></p>
                        <pre>${JSON.stringify(question.expectedOutput)}</pre>
                     `;
                            }
                        }
                    }
                    if (question?.answers) {
                        question.answers.forEach((answer, idx) => {
                            let answerColor = 'black';

                            if (idx === parseInt(userAnswerIndex)) {
                                answerColor = isCorrect ? 'green' : 'red';
                            }

                            reviewElement.innerHTML += `
                            <p style="color: ${answerColor};">
                                ${answer.answer}
                            </p>
                              `;
                        });
                    }

                    if (!isCorrect && question?.answers) {
                        // Find and display the correct answer only for non-code questions
                        const correctAnswer = question.answers.find(answer => answer.isCorrect);
                        if (correctAnswer) {
                            reviewElement.innerHTML += `
                        <p style="color: green;">
                            Correct Answer: ${correctAnswer.answer}
                        </p>
                        `;
                        }
                    }
                    if (isCorrect || isCorrectAnswer) {
                        totalMarks++;
                    }

                    reviewContainer.appendChild(reviewElement);
                });

                // Total Marks and Go Back Button
                const resultsWrapper = document.createElement('div');
                resultsWrapper.style.display = 'flex';
                resultsWrapper.style.justifyContent = 'space-between';
                resultsWrapper.style.alignItems = 'center';

                const totalMarksElement = document.createElement('p');
                totalMarksElement.innerHTML = `<strong>Total Marks: ${totalMarks} / ${quizQuestions.length}</strong>`;

                const goBackButton = document.createElement('button');
                goBackButton.textContent = 'Go Back';
                goBackButton.style.cssText = 'background: #0E3D57; color: #fff; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; width: 30%; text-align: center; margin-bottom: 3px; margin-left: auto;';
                goBackButton.addEventListener('click', async () => {
                    const userProgress = await fetchUserProgress(userId);
                    displayLessons(userId, userProgress);
                });
                resultsWrapper.appendChild(totalMarksElement);
                resultsWrapper.appendChild(goBackButton);
                // resultsWrapper.appendChild(retakeButton);
                reviewContainer.appendChild(resultsWrapper);

                document.getElementById('lessonsContainer').innerHTML = '';
                document.getElementById('lessonsContainer').appendChild(reviewContainer);
            };

            ///////////////////////////////////showEncouragementModal/////////////////////////

            function showEncouragementModal(completedLessons) {
                const modal = document.getElementById("encouragementModal");
                const progressBar = document.getElementById("progressBar");
                let encouragementMessage = "";
                if (completedLessons === 3) {
                    encouragementMessage = "🎉 Great start! You've completed the first 3 lessons! Keep up the amazing work! 🚀";
                } else if (completedLessons === 6) {
                    encouragementMessage = "👏 You're doing awesome! 6 lessons down! Keep building your knowledge! 🧠✨";
                } else if (completedLessons === 9) {
                    encouragementMessage = "🌟 You're halfway there! 9 lessons completed! Keep pushing forward! 💪";
                } else if (completedLessons === 12) {
                    encouragementMessage = "🔥 Almost there! 12 lessons completed! You're so close to the finish line! 🏁💼";
                } else if (completedLessons === 15) {
                    encouragementMessage = "🥳 Incredible effort! Just one more lesson to go! You've got this! 🎯🏆";
                } else {
                    encouragementMessage = `💪 You’ve completed ${completedLessons} lessons! Keep going and achieve greatness! 📈`;
                }
                modal.querySelector("p").textContent = encouragementMessage;

                // Reset progress bar and show modal
                progressBar.style.width = "100%";
                modal.style.display = "flex";

                // Animate the progress bar
                setTimeout(() => {
                    progressBar.style.width = "0%";
                }, 50); // Small delay for smooth transition

                // Auto-hide the modal after 10 seconds
                setTimeout(() => {
                    modal.style.display = "none";
                }, 10000);
            }
            const submitQuiz = async (userId, lessonId, userAnswers) => {

                // Reference to the user's document in the 'users' collection
                const userDocRef = doc(db, 'users', userId);
                const userDocSnap = await getDoc(userDocRef);

                if (userDocSnap.exists()) {
                    showEncouragementModal(userId);
                    // If the user document exists, return the progress field from the document
                    const userData = userDocSnap.data();
                    console.log('userData :', userData);
                    const completedLessons = Object.keys(userData.quizzes).length;
                    console.log('fetchUserProgress completedLessons :', completedLessons);

                    // Check if completed lessons are a multiple of 3
                    if (completedLessons > 0 && completedLessons % 3 === 0) {
                        showEncouragementModal(completedLessons);
                    }
                }

                try {
                    // First, reset any previous quiz data for a clean retake
                    await resetQuiz(userId, lessonId);

                    // Calculate total marks based on correct answers
                    const totalMarks = userAnswers.filter(answer => answer.isCorrect).length;

                    // Update Firestore with new answers and marks
                    await saveQuizResult(userId, lessonId, userAnswers);

                    // console.log("Quiz submitted successfully with new data.");

                } catch (error) {
                    console.error("Error submitting quiz:", error);
                }
            };

            const restartCourse = async () => {
                const currentUser = auth.currentUser;
                const userId = currentUser.uid; // Get the user ID
                console.log(' restartCourse currentUser : ', userId);

                if (!currentUser) {
                    console.error("No user is currently signed in.");
                    return;
                }
                const collRef = collection(db, ('users'));
                const userDocRef = doc(collRef, userId);

                try {
                    await updateDoc(userDocRef, {
                        quizzes: deleteField(),
                    })
                    console.log('Quizzes object successfully deleted for user:', userId);
                    const userProgress = await fetchUserProgress(userId);
                    displayLessons(userId, userProgress);
                } catch (error) {
                    console.error('Error deleting quizzes object:', error);
                }
            }


            startCourseBtn.addEventListener('click', () => {
                if (startCourseBtn.innerText === 'Restart Course') {
                    restartCourse(); // Call function to restart the course
                }
            });

            // Function to fetch user answers from Firestore
            const fetchUserAnswers = async (userId, lessonId) => {
                const userDocRef = doc(db, `users/${userId}`);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const quizzes = userData.quizzes || {}; // Get the quizzes map (or default to an empty object)
                    const lessonQuiz = quizzes[lessonId]; // Access the specific lesson's quiz data

                    if (lessonQuiz) {
                        return lessonQuiz.quizResult; // Return the quiz result for this lesson
                    }
                }
                return []; // Return an empty array if no quiz data exists for the lesson
            };

            // Function to fetch quiz questions from Firestore
            const fetchQuizQuestions = async (lessonId) => {
                const questionsRef = collection(db, 'Courses', 'SQL', 'lessons', lessonId, 'quiz', 'quizDoc', 'questions');
                const questionsSnapshot = await getDocs(questionsRef);

                return questionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            };
        });

        // Function to fetch the user's progress from Firestore
        const fetchUserProgress = async (userId) => {
            try {
                // Reference to the user's document in the 'users' collection
                const userDocRef = doc(db, 'users', userId);
                const userDocSnap = await getDoc(userDocRef);

                if (userDocSnap.exists()) {
                    const userData = userDocSnap.data();
                    return userData.quizzes || {}; // Return the progress object, or an empty object if it doesn't exist
                } else {
                    console.error(`No such user document for userId: ${userId}`);
                    return {};
                }
            } catch (error) {
                console.error("Error fetching user progress:", error);
                return {};
            }
        };
        // Click anywhere to close the profile section
        document.addEventListener('click', (event) => {
            const isClickInsideProfile = profileSection.contains(event.target) || profileIcon.contains(event.target);
            if (!isClickInsideProfile) {
                profileSection.style.display = 'none'; // Hide the profile section
            }
        });
    </script>
</head>

<body>
    <div class="wrapper">
        <header class="header">
            <!-- Top Bar -->
            <div class="top_bar">
                <div class="top_bar_container">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="top_bar_content d-flex flex-row align-items-center justify-content-start">
                                    <ul class="top_bar_contact_list">
                                        <li>
                                            <div id="BtnQuestion" class="BtnQuestionC">Have any questions?</div>
                                        </li>
                                        <li>
                                            <div>Albaiti.ahmed@live.iium.edu.my</div>
                                        </li>
                                        <li>
                                            <div>mazin.muhammed@live.iium.edu.my</div>
                                        </li>
                                    </ul>
                                    <div class="top_bar_login ml-auto" id="authContainer">
                                        <ul id="authLinks"
                                            style="list-style: none; margin: 0; padding: 0; display: flex;">
                                            <li style="margin-right: 1px;"><a href="signUp.html"
                                                    style="text-decoration: none; color: #fff;">Register</a></li>
                                            <li><a href="login.html"
                                                    style="text-decoration: none; color: #fff;">Login</a>
                                            </li>
                                        </ul>
                                        <div id="profileContainer" style="position: relative; display: inline-block;">
                                            <i class="fas fa-user-alt" id="profileIcon"
                                                style="font-size: 24px; color: #fff; cursor: pointer; margin-right: 20px; transition: color 0.3s ease;"></i>

                                            <div id="profileSection" style="display: none; 
                                                position: absolute; 
                                                right: 0; 
                                                top: 35px; 
                                                background-color: #fff; 
                                                border: 1px solid #ddd; 
                                                padding: 20px; 
                                                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); 
                                                border-radius: 10px; 
                                                z-index: 100; 
                                                width: 280px; 
                                                transition: all 0.3s ease;">
                                                <span id="userName"
                                                    style="display: block; color: #0E3D57; margin-bottom: 10px; font-size: 0.9rem;">Name
                                                    :</span>
                                                <span id="userEmail"
                                                    style="display: block; color: #0E3D57; margin-bottom: 20px; font-size: 0.9rem;">Email
                                                    :</span>

                                                <button id="myProgressButton" class="myProgressButton">
                                                    View My Progress
                                                </button>

                                                <button id="signOutButton" class="signOutButton">
                                                    Sign Out
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Header Content -->
            <div class="header_container">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="header_content d-flex flex-row align-items-center justify-content-start">
                                <div class="logo_container">
                                    <a href="#">
                                        <div class="logo_content d-flex flex-row align-items-end justify-content-start">
                                            <div class="logo_img"><img src="images/assets//DataED_logo.jpg" alt=""
                                                    style="width: 80px;"></div>
                                        </div>
                                    </a>
                                </div>
                                <nav class="main_nav_contaner ml-auto">
                                    <ul class="main_nav">
                                        <li><a href="index.html">home</a></li>
                                        <li><a href="about.html">about us</a></li>
                                        <li class="active"><a href="courses.html">lessons</a></li>
                                        <!-- <li><a href="news.html">news</a></li> -->
                                        <li><a href="contact.html"></a></li>
                                    </ul>
                                    <!-- <div class="search_button"><i class="fa fa-search" aria-hidden="true"></i></div> -->

                                    <!-- Hamburger -->

                                    <div class="hamburger menu_mm">
                                        <i class="fa fa-bars menu_mm" aria-hidden="true"></i>
                                    </div>
                                </nav>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Header Search Panel -->
            <div class="header_search_container">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="header_search_content d-flex flex-row align-items-center justify-content-end">
                                <form action="#" class="header_search_form">
                                    <input type="search" class="search_input" placeholder="Search" required="required">
                                    <button
                                        class="header_search_button d-flex flex-column align-items-center justify-content-center">
                                        <i class="fa fa-search" aria-hidden="true"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- SQL Page Content -->
        <div class="sql-content container my-5" style="max-height: 10000px;">
            <div id="encouragementModal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <h2>Great Job!</h2>
                    <p>You’ve completed another milestone! Keep it up! 🌟</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>
            </div>
            <div id="progress" style="font-family: Arial, sans-serif; font-size: 18px;">
                <!-- Progress details will be dynamically inserted here -->
            </div>
            <!-- Overview Section -->
            <div id="courseOverview" class="overview-section text-center mb-5"
                style="max-width: 800px; margin: 50px auto 0 auto;">
                <p style="font-size: 1.2rem; color: #555;">
                    This course provides a comprehensive foundation in SQL databases, covering the essential concepts
                    needed
                    to
                    interact with and manage data. Designed for beginners, the course consists of 6 lessons that will
                    guide
                    you
                    through the basics of SQL step-by-step.
                </p>
                <button id="startCourseBtn" class="start-course" style="border-radius: 20px; display: none;"></button>
            </div>
            <!-- Lessons Container -->
            <div id="lessonsContainer" style="display: none;">
            </div>
        </div>
        <!-- End of SQL Page Content -->
        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <!-- About -->
                    <div class="col-lg-3 footer_col">
                        <div class="footer_about">
                            <div class="logo_container">
                                <a href="index.html">
                                    <div class="logo_content d-flex flex-row align-items-end justify-content-start">
                                        <div class="logo_img"><img src="images/assets/DataED_logo.jpg" alt=""
                                                style="width: 80px;"></div>
                                    </div>
                                </a>
                            </div>
                            <div class="footer_about_text">
                                <p>Welcome to our website. We are dedicated to providing quality content and exceptional
                                    service to our users. Your feedback is valuable to us as we strive for continuous
                                    improvement.</p>
                            </div>
                            <div class="footer_social">
                                <ul>
                                    <li><a href="https://plus.google.com/" target="_blank" rel="noopener noreferrer"><i
                                                class="fab fa-google-plus" aria-hidden="true"></i></a></li>
                                    <li><a href="https://www.pinterest.com/" target="_blank"
                                            rel="noopener noreferrer"><i class="fab fa-pinterest"
                                                aria-hidden="true"></i></a></li>
                                    <li><a href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer"><i
                                                class="fab fa-facebook" aria-hidden="true"></i></a></li>
                                    <li><a href="https://x.com/" target="_blank" rel="noopener noreferrer"><i
                                                class="fab fa-twitter" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 footer_col">
                        <div class="footer_links">
                            <div class="footer_title">Quick menu</div>
                            <ul class="footer_list">
                                <li><a href="index.html">Home</a></li>
                                <li><a href="about.html">About us</a></li>
                                <li><a href="contact.html">Contact Us</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="col-lg-3 footer_col">
                        <div class="footer_contact">
                            <div class="footer_title">Contact Us</div>
                            <div class="footer_contact_info">
                                <div class="footer_contact_item">
                                    <div class="footer_contact_title">Address:</div>
                                    <div class="footer_contact_line">Jalan Gombak, 53100 Kuala Lumpur,
                                        Malaysia</div>
                                </div>
                                <div class="footer_contact_item">
                                    <div class="footer_contact_title">Phone:</div>
                                    <div class="footer_contact_line">+966 532666580</div>
                                </div>
                                <div class="footer_contact_item">
                                    <div class="footer_contact_title">Email:</div>
                                    <div class="footer_contact_line">Albaiti.ahmed@live.iium.edu.my</div>
                                    <div class="footer_contact_line">mazin.muhammed@live.iium.edu.my</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="styles/bootstrap4/popper.js"></script>
    <script src="styles/bootstrap4/bootstrap.min.js"></script>
    <script src="plugins/greensock/TweenMax.min.js"></script>
    <script src="plugins/greensock/TimelineMax.min.js"></script>
    <script src="plugins/scrollmagic/ScrollMagic.min.js"></script>
    <script src="plugins/greensock/animation.gsap.min.js"></script>
    <script src="plugins/greensock/ScrollToPlugin.min.js"></script>
    <script src="plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
    <script src="plugins/easing/easing.js"></script>
    <script src="plugins/video-js/video.min.js"></script>
    <script src="plugins/video-js/Youtube.min.js"></script>
    <script src="plugins/parallax-js-master/parallax.min.js"></script>
    <script src="js/custom.js"></script>
</body>

</html>